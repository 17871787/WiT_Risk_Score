var e=Object.defineProperty,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;import{a as i,u as r,j as l,r as c,v as o,f as m,w as d}from"./index-294fea26.js";import{r as x}from"./react-vendor-3e9c946d.js";import{g as p,h,Z as g,i as u,L as j,M as b,c as y,T as N,j as f,k as v,l as w}from"./ui-vendor-fd39ecb8.js";import"./state-15ddd646.js";const M=()=>{const e=i(),{parameters:s,updateParameter:t}=e;r();const a=[{id:"extend-grazing",name:"Extend Grazing Period",description:"Add 1 month to grazing season",icon:l.jsx(h,{className:"w-5 h-5"}),apply:()=>t("grazingMonths",Math.min(12,s.grazingMonths+1)),revert:()=>t("grazingMonths",Math.max(0,s.grazingMonths-1)),isApplied:()=>s.grazingMonths>7,impact:"-3% emissions"},{id:"solar-panels",name:"Install Solar Panels",description:"Add 50 kW renewable capacity",icon:l.jsx(g,{className:"w-5 h-5"}),apply:()=>t("renewableEnergyKw",s.renewableEnergyKw+50),revert:()=>t("renewableEnergyKw",Math.max(0,s.renewableEnergyKw-50)),isApplied:()=>s.renewableEnergyKw>0,impact:"-20 t CO₂e/year"},{id:"methane-inhibitor",name:"Methane Inhibitor Feed",description:"Add feed additives to reduce enteric emissions",icon:l.jsx(u,{className:"w-5 h-5"}),apply:()=>t("methaneInhibitor",!0),revert:()=>t("methaneInhibitor",!1),isApplied:()=>s.methaneInhibitor,impact:"-15% enteric"},{id:"improved-manure",name:"Upgrade Manure System",description:"Implement covered storage and treatment",icon:l.jsx(j,{className:"w-5 h-5"}),apply:()=>t("improvedManure",!0),revert:()=>t("improvedManure",!1),isApplied:()=>s.improvedManure,impact:"-30% manure"},{id:"tree-planting",name:"Plant Trees",description:"Add 5 hectares of woodland",icon:l.jsx(j,{className:"w-5 h-5"}),apply:()=>t("treePlantingHa",s.treePlantingHa+5),revert:()=>t("treePlantingHa",Math.max(0,s.treePlantingHa-5)),isApplied:()=>s.treePlantingHa>0,impact:"+60 t CO₂e/year seq"},{id:"reduce-nitrogen",name:"Optimize Nitrogen Use",description:"Reduce application by 20 kg/ha",icon:l.jsx(b,{className:"w-5 h-5"}),apply:()=>t("nitrogenRate",Math.max(100,s.nitrogenRate-20)),revert:()=>t("nitrogenRate",s.nitrogenRate+20),isApplied:()=>s.nitrogenRate<180,impact:"-5% N₂O"},{id:"improve-feed-quality",name:"Improve Feed Quality",description:"Upgrade feed quality by 2 points",icon:l.jsx(u,{className:"w-5 h-5"}),apply:()=>t("feedQuality",Math.min(10,s.feedQuality+2)),revert:()=>t("feedQuality",Math.max(1,s.feedQuality-2)),isApplied:()=>s.feedQuality>7,impact:"+15% NUE"},{id:"reduce-concentrate",name:"Optimize Concentrate Feed",description:"Reduce concentrate by 1 kg/day",icon:l.jsx(b,{className:"w-5 h-5"}),apply:()=>t("concentrateFeed",Math.max(0,s.concentrateFeed-1)),revert:()=>t("concentrateFeed",s.concentrateFeed+1),isApplied:()=>s.concentrateFeed<8,impact:"+10% feed efficiency"}];return l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[l.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Quick Scenario Builder"}),l.jsx("p",{className:"text-sm text-blue-700",children:"Toggle practices below to see their impact on your emissions and costs. Each change updates calculations in real-time."})]}),l.jsx("div",{className:"space-y-3",children:a.map(e=>l.jsx("div",{className:`\n              border rounded-lg p-4 transition-all cursor-pointer\n              ${e.isApplied()?"bg-green-50 border-green-300":"bg-white border-gray-200 hover:border-gray-300"}\n            `,onClick:()=>e.isApplied()?e.revert():e.apply(),children:l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-start space-x-3",children:[l.jsx("div",{className:`\n                  p-2 rounded-lg\n                  ${e.isApplied()?"bg-green-200 text-green-700":"bg-gray-100 text-gray-600"}\n                `,children:e.icon}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h4",{className:"font-medium text-gray-900",children:e.name}),l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),l.jsx("div",{className:"flex items-center mt-2 space-x-4",children:l.jsx("span",{className:"text-xs font-medium text-green-600",children:e.impact})})]})]}),l.jsx("button",{className:`\n                  px-3 py-1 rounded-md text-sm font-medium transition-colors\n                  ${e.isApplied()?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}\n                `,onClick:s=>{s.stopPropagation(),e.isApplied()?e.revert():e.apply()},children:e.isApplied()?"Active":"Apply"})]})},e.id))}),l.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mt-6",children:[l.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Active Practices Summary"}),l.jsxs("div",{className:"space-y-1",children:[a.filter(e=>e.isApplied()).map(e=>l.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[l.jsx(p,{className:"w-4 h-4 text-green-600 mr-2"}),e.name]},e.id)),0===a.filter(e=>e.isApplied()).length&&l.jsx("p",{className:"text-sm text-gray-500 italic",children:"No practices applied yet. Click on any practice above to see its impact."})]})]})]})},P=()=>{const e=r();i();const s=x.useMemo(()=>({grossEmissions:1234,sequestration:50,netEmissions:1184,emissionsIntensity:1.45,costPerLitre:.31,annualProfit:125e3,lme:7500}),[]),t=[{label:"Gross Emissions",baseline:s.grossEmissions,scenario:e.totalFarmEmissions,unit:"t CO₂e/year",format:e=>e.toFixed(0),inverse:!0},{label:"Sequestration",baseline:s.sequestration,scenario:e.sequestration.totalSequestration,unit:"t CO₂e/year",format:e=>e.toFixed(0),inverse:!1},{label:"Net Emissions",baseline:s.netEmissions,scenario:e.netFarmEmissions,unit:"t CO₂e/year",format:e=>e.toFixed(0),inverse:!0},{label:"Emissions Intensity",baseline:s.emissionsIntensity,scenario:e.emissionsIntensity,unit:"kg CO₂e/L",format:e=>e.toFixed(2),inverse:!0},{label:"Cost per Litre",baseline:s.costPerLitre,scenario:e.costPerLitre,unit:"£/L",format:e=>e.toFixed(3),inverse:!0},{label:"Annual Profit",baseline:s.annualProfit,scenario:e.totalFarmProfit,unit:"£",format:e=>`£${(e/1e3).toFixed(0)}k`,inverse:!1},{label:"Lifetime Methane Efficiency",baseline:s.lme,scenario:e.lmeResult.lme,unit:"L/t CO₂e",format:e=>e.toFixed(0),inverse:!1}],a=(e,s)=>{if(Math.abs(e)<.01)return l.jsx(b,{className:"w-4 h-4 text-gray-400"});return(s?e<0:e>0)?l.jsx(y,{className:"w-4 h-4 text-green-600"}):l.jsx(N,{className:"w-4 h-4 text-red-600"})},n=(e,s)=>{if(Math.abs(e)<.01)return"text-gray-600";return(s?e<0:e>0)?"text-green-600":"text-red-600"};return l.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[l.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scenario Comparison"}),l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full",children:[l.jsx("thead",{children:l.jsxs("tr",{className:"border-b",children:[l.jsx("th",{className:"text-left py-2 pr-4 text-sm font-medium text-gray-700",children:"Metric"}),l.jsx("th",{className:"text-right px-4 py-2 text-sm font-medium text-gray-700",children:"Baseline"}),l.jsx("th",{className:"text-right px-4 py-2 text-sm font-medium text-gray-700",children:"Scenario"}),l.jsx("th",{className:"text-center px-4 py-2 text-sm font-medium text-gray-700",children:"Change"})]})}),l.jsx("tbody",{children:t.map(e=>{const s=e.scenario-e.baseline,t=((e,s)=>{const t=(s-e)/e*100;return`${t>0?"+":""}${t.toFixed(1)}%`})(e.baseline,e.scenario);return l.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[l.jsx("td",{className:"py-3 pr-4",children:l.jsxs("div",{children:[l.jsx("div",{className:"font-medium text-gray-900",children:e.label}),l.jsx("div",{className:"text-xs text-gray-500",children:e.unit})]})}),l.jsx("td",{className:"text-right px-4 py-3 text-gray-700",children:e.format(e.baseline)}),l.jsx("td",{className:"text-right px-4 py-3 font-medium text-gray-900",children:e.format(e.scenario)}),l.jsx("td",{className:"text-center px-4 py-3",children:l.jsxs("div",{className:`flex items-center justify-center space-x-1 ${n(s,e.inverse||!1)}`,children:[a(s,e.inverse||!1),l.jsx("span",{className:"font-medium text-sm",children:t})]})})]},e.label)})})]})}),l.jsx("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:l.jsxs("div",{className:"flex items-start space-x-3",children:[l.jsx(y,{className:"w-5 h-5 text-green-600 mt-0.5"}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-medium text-green-900",children:"Overall Impact"}),l.jsxs("p",{className:"text-sm text-green-700 mt-1",children:["Net emissions reduced by ",Math.round((s.netEmissions-e.netFarmEmissions)/s.netEmissions*100),"%",e.totalFarmProfit>s.annualProfit&&` while increasing profit by £${((e.totalFarmProfit-s.annualProfit)/1e3).toFixed(0)}k`]})]})]})})]})},F=({baselineParams:e,scenarioParams:s,scenarioName:t})=>{const a=x.useMemo(()=>{const s=c(e);return 1e3*o(s.totalAnnualEmissions,e.herdSize)},[e]),n=a-x.useMemo(()=>{const e=c(s);return 1e3*o(e.totalAnnualEmissions,s.herdSize)},[s]),i=n/a*100,r=x.useMemo(()=>m(s),[s]),p=x.useMemo(()=>d(r,720,0),[r]),h=x.useMemo(()=>{const t=[];if(s.methaneInhibitor&&!e.methaneInhibitor&&t.push({name:"Methane Inhibitor",cost:3e4}),s.improvedManure&&!e.improvedManure&&t.push({name:"Improved Manure System",cost:5e4}),s.renewableEnergyKw>e.renewableEnergyKw){const a=s.renewableEnergyKw-e.renewableEnergyKw;t.push({name:`Solar Panels (${a} kW)`,cost:1500*a})}if(s.treePlantingHa>e.treePlantingHa){const a=s.treePlantingHa-e.treePlantingHa;t.push({name:`Tree Planting (${a} ha)`,cost:2e3*a})}return s.grazingMonths>e.grazingMonths&&t.push({name:"Extended Grazing",cost:1e4}),s.nitrogenRate<e.nitrogenRate&&t.push({name:"Nitrogen Optimization",cost:5e3}),t},[e,s]),g=h.reduce((e,s)=>e+s.cost,0),u=.025*n,j=g/u;return l.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[l.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Financing Analysis: ",t]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[l.jsxs("div",{className:"bg-green-50 p-3 rounded",children:[l.jsxs("div",{className:"flex items-center gap-2 text-green-700 mb-1",children:[l.jsx(y,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs font-medium",children:"Emissions Reduction"})]}),l.jsxs("p",{className:"text-xl font-bold text-green-900",children:[i.toFixed(1),"%"]}),l.jsxs("p",{className:"text-xs text-green-600",children:[n.toFixed(0)," kg CO₂e/year"]})]}),l.jsxs("div",{className:"bg-blue-50 p-3 rounded",children:[l.jsxs("div",{className:"flex items-center gap-2 text-blue-700 mb-1",children:[l.jsx(f,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs font-medium",children:"Total Investment"})]}),l.jsxs("p",{className:"text-xl font-bold text-blue-900",children:["$",g.toLocaleString()]}),l.jsx("p",{className:"text-xs text-blue-600",children:"One-time cost"})]}),l.jsxs("div",{className:"bg-purple-50 p-3 rounded",children:[l.jsxs("div",{className:"flex items-center gap-2 text-purple-700 mb-1",children:[l.jsx(v,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs font-medium",children:"Simple Payback"})]}),l.jsxs("p",{className:"text-xl font-bold text-purple-900",children:[j.toFixed(1)," years"]}),l.jsx("p",{className:"text-xs text-purple-600",children:"From carbon credits"})]}),l.jsxs("div",{className:"bg-yellow-50 p-3 rounded",children:[l.jsxs("div",{className:"flex items-center gap-2 text-yellow-700 mb-1",children:[l.jsx(w,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs font-medium",children:"Monthly Payment"})]}),l.jsxs("p",{className:"text-xl font-bold text-yellow-900",children:["$",p.totalMonthlyCost.toFixed(0)]}),l.jsx("p",{className:"text-xs text-yellow-600",children:"With financing"})]})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Investment Breakdown"}),l.jsxs("div",{className:"space-y-2",children:[h.map((e,s)=>l.jsxs("div",{className:"flex justify-between items-center py-2 border-b",children:[l.jsx("span",{className:"text-sm text-gray-600",children:e.name}),l.jsxs("span",{className:"text-sm font-medium",children:["$",e.cost.toLocaleString()]})]},s)),l.jsxs("div",{className:"flex justify-between items-center pt-2",children:[l.jsx("span",{className:"text-sm font-semibold",children:"Total"}),l.jsxs("span",{className:"text-sm font-bold",children:["$",g.toLocaleString()]})]})]})]}),l.jsxs("div",{className:"bg-gray-50 rounded p-4",children:[l.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Recommended Financing"}),p.financingOptions.length>0?l.jsx("div",{className:"space-y-2",children:p.financingOptions.slice(0,3).map((e,s)=>l.jsxs("div",{className:"flex justify-between items-start text-sm",children:[l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:e.option.name}),l.jsxs("p",{className:"text-xs text-gray-600",children:["$",e.amount.toLocaleString()," at ",(100*(e.option.interestRate-e.option.greenDiscount)).toFixed(1),"%"]})]}),l.jsxs("div",{className:"text-right",children:[l.jsxs("p",{className:"font-medium",children:["$",e.monthlyCost.toFixed(0),"/mo"]}),l.jsxs("p",{className:"text-xs text-gray-600",children:[e.option.term," years"]})]})]},s))}):l.jsx("p",{className:"text-sm text-gray-600",children:"No financing needed - practices already implemented"}),l.jsxs("div",{className:"mt-3 pt-3 border-t",children:[l.jsx("div",{className:"flex justify-between items-center",children:l.jsx("span",{className:"text-sm font-medium",children:"Financial Summary"})}),l.jsxs("div",{className:"mt-2 space-y-1 text-xs text-gray-600",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"NPV (10 years):"}),l.jsxs("span",{className:p.netPresentValue>0?"text-green-600 font-medium":"text-red-600",children:["$",p.netPresentValue.toFixed(0)]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"IRR:"}),l.jsxs("span",{className:"font-medium",children:[(100*p.internalRateOfReturn).toFixed(1),"%"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Carbon value/year:"}),l.jsxs("span",{className:"font-medium",children:["$",u.toFixed(0)]})]})]})]})]}),g>0&&l.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:l.jsxs("p",{className:"text-sm text-green-800",children:["💡 This scenario qualifies for green financing with monthly payments as low as",l.jsxs("span",{className:"font-semibold",children:[" $",p.totalMonthlyCost.toFixed(0)]})]})})]})},E=({state:e,actions:r})=>{const c=i(e=>e.parameters),[o]=x.useState(((e,i)=>{for(var r in i||(i={}))t.call(i,r)&&n(e,r,i[r]);if(s)for(var r of s(i))a.call(i,r)&&n(e,r,i[r]);return e})({},c)),m=x.useMemo(()=>c.methaneInhibitor!==o.methaneInhibitor||c.improvedManure!==o.improvedManure||c.renewableEnergyKw!==o.renewableEnergyKw||c.treePlantingHa!==o.treePlantingHa||c.grazingMonths!==o.grazingMonths||c.nitrogenRate!==o.nitrogenRate,[c,o]);return l.jsxs("div",{className:"p-6",children:[l.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Scenario Planning & What-If Analysis"}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsx("div",{children:l.jsx(M,{})}),l.jsx("div",{children:l.jsx(P,{})})]}),m&&l.jsx("div",{className:"mt-6",children:l.jsx(F,{baselineParams:o,scenarioParams:c,scenarioName:"Current Scenario"})})]})};export{E as default};
